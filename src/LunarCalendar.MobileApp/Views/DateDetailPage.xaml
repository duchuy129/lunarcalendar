<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:LunarCalendar.MobileApp.ViewModels"
             x:Class="LunarCalendar.MobileApp.Views.DateDetailPage"
             x:DataType="vm:DateDetailViewModel"
             Title="Date Details"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsBusy}"
                             IsRunning="{Binding IsBusy}"
                             Color="{DynamicResource Primary}"
                             HeightRequest="40"/>

            <VerticalStackLayout Spacing="20" IsVisible="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}">

                <!-- Gregorian Date Header -->
                <Frame Padding="20" 
                       CornerRadius="12"
                       BackgroundColor="{DynamicResource CardBackgroundColor}"
                       HasShadow="False"
                       BorderColor="{DynamicResource BorderColor}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="{Binding GregorianDateDisplay}"
                               FontSize="28"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"
                               TextColor="{DynamicResource PrimaryTextColor}"/>
                        
                        <Label Text="{Binding DayOfWeekDisplay}"
                               FontSize="18"
                               HorizontalTextAlignment="Center"
                               TextColor="{DynamicResource SecondaryTextColor}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Lunar Date Card -->
                <Frame Padding="20" 
                       CornerRadius="12"
                       BackgroundColor="{DynamicResource CardBackgroundColor}"
                       HasShadow="False"
                       BorderColor="{DynamicResource BorderColor}">
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="ðŸŒ™"
                                   FontSize="24"
                                   VerticalOptions="Center"/>
                            <Label Text="Lunar Date"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                            
                            <!-- Leap Month Indicator -->
                            <Border IsVisible="{Binding IsLeapMonth}"
                                    BackgroundColor="{DynamicResource Warning}"
                                    Stroke="{DynamicResource Warning}"
                                    StrokeThickness="0"
                                    Padding="8,4"
                                    VerticalOptions="Center"
                                    Margin="4,0,0,0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="10"/>
                                </Border.StrokeShape>
                                <Label Text="Leap"
                                       FontSize="12"
                                       TextColor="White"
                                       FontAttributes="Bold"/>
                            </Border>
                        </HorizontalStackLayout>

                        <Label Text="{Binding LunarDateDisplay}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="{DynamicResource PrimaryTextColor}"
                               Margin="34,0,0,0"/>

                        <Label Text="{Binding LunarMonthYearDisplay}"
                               FontSize="16"
                               TextColor="{DynamicResource SecondaryTextColor}"
                               Margin="34,0,0,0"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Stem-Branch Card -->
                <Frame Padding="20" 
                       CornerRadius="12"
                       BackgroundColor="{DynamicResource CardBackgroundColor}"
                       HasShadow="False"
                       BorderColor="{DynamicResource BorderColor}">
                    <VerticalStackLayout Spacing="16">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="ðŸŽ‹"
                                   FontSize="24"
                                   VerticalOptions="Center"/>
                            <Label Text="Stem-Branch (Can Chi)"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                        </HorizontalStackLayout>

                        <!-- Day Stem-Branch with Element -->
                        <VerticalStackLayout Spacing="8">
                            <HorizontalStackLayout Spacing="12">
                                <Ellipse WidthRequest="20" 
                                        HeightRequest="20"
                                        Fill="{Binding DayElementColor}"
                                        VerticalOptions="Center"/>
                                <Label Text="{Binding DayStemBranchDisplay}"
                                       FontSize="22"
                                       FontAttributes="Bold"
                                       VerticalOptions="Center"
                                       TextColor="{DynamicResource PrimaryTextColor}"/>
                            </HorizontalStackLayout>
                            
                            <Label Text="{Binding DayElementDisplay}"
                                   FontSize="14"
                                   TextColor="{DynamicResource SecondaryTextColor}"
                                   Margin="32,0,0,0"/>
                        </VerticalStackLayout>

                        <BoxView HeightRequest="1" 
                                Color="{DynamicResource BorderColor}"
                                Opacity="0.3"/>

                        <!-- Month Stem-Branch -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="ðŸ“…"
                                   FontSize="18"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding MonthStemBranchDisplay}"
                                   FontSize="18"
                                   VerticalOptions="Center"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                        </HorizontalStackLayout>

                        <!-- Year Stem-Branch -->
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="ðŸ—“ï¸"
                                   FontSize="18"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding YearStemBranchDisplay}"
                                   FontSize="18"
                                   VerticalOptions="Center"
                                   TextColor="{DynamicResource PrimaryTextColor}"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Holiday Card (conditional) -->
                <Frame Padding="20" 
                       CornerRadius="12"
                       BackgroundColor="{DynamicResource CardBackgroundColor}"
                       HasShadow="False"
                       BorderColor="{Binding HolidayColor}"
                       IsVisible="{Binding HasHoliday}">
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="ðŸŽ‰"
                                   FontSize="24"
                                   VerticalOptions="Center"/>
                            <Label Text="{Binding HolidayName}"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   VerticalOptions="Center"
                                   TextColor="{Binding HolidayColor}"/>
                        </HorizontalStackLayout>

                        <Label Text="{Binding HolidayDescription}"
                               FontSize="16"
                               TextColor="{DynamicResource SecondaryTextColor}"
                               IsVisible="{Binding HolidayDescription, Converter={StaticResource StringNotEmptyConverter}}"
                               Margin="34,0,0,0"/>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
